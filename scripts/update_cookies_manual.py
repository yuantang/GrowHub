import asyncio
import sys
import os
# Add root to sys.path
sys.path.append(os.getcwd())

from sqlalchemy import text
from database.db_session import get_session

NEW_COOKIES = """gd_random=eyJwZXJjZW50IjowLjE3ODk3MTg1OTM5MDQxMTgyLCJtYXRjaCI6ZmFsc2V9.Ow9i0KS2u6DVUBdz+Bh6NOkb0Yip8LzZfDVMHqEKMao=; gd_random=eyJtYXRjaCI6ZmFsc2UsInBlcmNlbnQiOjAuODc4NjAxNTI3Mzk1NjE0NX0=.Pr//3LQ48kmGj1SYgAGCRmkyqEt7yUoq9uHZ4bGXORo=; MONITOR_WEB_ID=37deaefb-923a-40ae-a4d6-4c07189ab3a5; MONITOR_DEVICE_ID=6b6e2297-05f6-4730-b4e5-5f7d4eb8666a; leads_pc_ies_user_id=1266225133388723; s_v_web_id=verify_mk6gvzh1_mFOd9pTy_CTpd_4XZP_AIvt_ZRZbQUSTj6Dj; bd_ticket_guard_web_domain=2; fpk1=U2FsdGVkX19m6AT7cQNoJOg0NXKLcmhEovyNkSpheArFs9KUScLvYkdLCzLEk0ICsSN0wmTrnG7MBqGGOSsnaw==; fpk2=36be35c8d663a73934cdf2404412fa9b; gfkadpd=2906,33638; _tea_utm_cache_2906=undefined; count-client-api_sid=eyJfZXhwaXJlIjoxNzcwNzc1MDQxNzEzLCJfbWF4QWdlIjoxMjA5NjAwMDAwfQ==; ttcid=2af92e23e94245f7bd280f84c99a3e2311; tt_scid=zH1-jOZ1ZhGCprj-W7Kd6H45owNnsnbPl2PxibzgyseQdeNeSCestX.8JtTl.i-dbb61; enter_pc_once=1; UIFID_TEMP=e4c262a6b5e3b5badbd561631828ceb96cf9bda1502c8aff5f66458d92ccf6f3c77150fb6aebe6c2d97aee4e842e75dfc8608d9da914099df6f6d79ac76a51b99707df3b5cb5fce01234c1465c52fc17; s_v_web_id=verify_mkxwsnnd_RmNFKQcE_DVFI_4XaK_B0aY_NtWIbhG5BVuH; hevc_supported=true; fpk1=U2FsdGVkX1+a9kR0V92DUOsBQ9tTvWMgy/1217uTmbc2JNNS7Dqjm4lt+TsRFW7k2mBsbbS9ZpLiruVhmhowNQ==; fpk2=36be35c8d663a73934cdf2404412fa9b; is_dash_user=1; bd_ticket_guard_client_web_domain=2; passport_csrf_token=e5ad6695c521d8a7335eef090e59f0b7; passport_csrf_token_default=e5ad6695c521d8a7335eef090e59f0b7; UIFID=e4c262a6b5e3b5badbd561631828ceb96cf9bda1502c8aff5f66458d92ccf6f3b8c8ea3a74699740088b623a15603f7bd7955ab76866f8e9bfccadf5681b2156df45dfb06dbe513b2505c89c35c4c3e3b871f04d8aa406f6602081d869e90835e46e3199d0c0439993e28523a0e7b46273e362d7a26239327983c38f56dd3f7502cefee56ff43a962a351ea98fe5348f35664f39b51deec1d0503dd72daba1fb; strategyABtestKey=%221769647050.995%22; ttwid=1%7CCD4fwGdugraSv-ZMM1Ft5XLKly4OyeO91a7Ao3nxyBY%7C1769647051%7Ce9366fa9d9d40dd49531bc28a3f83cae9e8e294f62e4f5b18ea0893dc2f9ecde; passport_mfa_token=Cjcev63HASxxZ%2B8XwYQqVt9fZw5q9RLxhuOMMDAgVMRk3FWMhVChhHom1xTB2e21OQjtftvUZeUzGkoKPAAAAAAAAAAAAABQAXZAFSpGnpm8zpI3AeM1IZQCaxqL7lNlwqSyjlBEnU3cWWy%2Fk8dCxw8yV15tlU1LrxDNlYgOGPax0WwgAiIBA3Huevs%3D; d_ticket=1836e22e2452aa428adf7d3dda98c42acec8b; passport_assist_user=CkGCqR-_ySHJARNjq4CQurHJ8iAEzGjn81ccR6d_hffWVXRZ3r4lGx71Q716CPOMnWomyIs6S3NwXA5-i54fcJqf6BpKCjwAAAAAAAAAAAAAUAE4z0ewtLRVuMNm_GG5FlR3l_Bu3Dif7SwwQe5AS8CXnJK9yq9U7LkjyKBt4UKklZcQ_pSIDhiJr9ZUIAEiAQNRiNEW; n_mh=YkJ5F0eyAZFYG7RaGlIX1e8WnOtvsjxap58bHe3dG9g; sid_guard=fd4c3e9aa340d0e55b53b350fa5ab55c%7C1769647085%7C5184000%7CMon%2C+30-Mar-2026+00%3A38%3A05+GMT; uid_tt=1250f529d47afd4a9d67309fbcdd5f4a; uid_tt_ss=1250f529d47afd4a9d67309fbcdd5f4a; sid_tt=fd4c3e9aa340d0e55b53b350fa5ab55c; sessionid=fd4c3e9aa340d0e55b53b350fa5ab55c; sessionid_ss=fd4c3e9aa340d0e55b53b350fa5ab55c; session_tlb_tag=sttt%7C1%7C_Uw-mqNA0OVbU7NQ-lq1XP________-5oOgaZ-UuTU3S1LkXsBi8CZMrebz2qWraDxuQitv2ca0%3D; is_staff_user=false; sid_ucp_v1=1.0.0-KGExZmEwODhmNGJmY2UxYjc0M2FmMDU2OWE5NjE0ZWQ4N2QxMGQ5MDYKIQizh6CagPSfAhDt1-rLBhjvMSAMMOCIgfgFOAdA9AdIBBoCbHEiIGZkNGMzZTlhYTM0MGQwZTU1YjUzYjM1MGZhNWFiNTVj; ssid_ucp_v1=1.0.0-KGExZmEwODhmNGJmY2UxYjc0M2FmMDU2OWE5NjE0ZWQ4N2QxMGQ5MDYKIQizh6CagPSfAhDt1-rLBhjvMSAMMOCIgfgFOAdA9AdIBBoCbHEiIGZkNGMzZTlhYTM0MGQwZTU1YjUzYjM1MGZhNWFiNTVj; _bd_ticket_crypt_cookie=9c5a29d311fd476a8916cc73c76fa6b9; __security_mc_1_s_sdk_sign_data_key_web_protect=7ffa64e8-4a30-a1e2; __security_mc_1_s_sdk_cert_key=67efe5ef-43a1-91fa; __security_mc_1_s_sdk_crypt_sdk=139509aa-4de9-a910; __security_server_data_status=1; login_time=1769647085144; DiscoverFeedExposedAd=%7B%7D; SelfTabRedDotControl=%5B%7B%22id%22%3A%227591840064322144291%22%2C%22u%22%3A19%2C%22c%22%3A0%7D%5D; download_guide=%223%2F20260129%2F1%22; publish_badge_show_info=%221%2C0%2C0%2C1769647087020%22; my_rd=2; __ac_signature=_02B4Z6wo00f01VFB8CQAAIDDYtQGZpAfKSlRYfSAAD0vd3; dy_swidth=1920; dy_sheight=1080; FOLLOW_NUMBER_YELLOW_POINT_INFO=%22MS4wLjABAAAAVyy1S3Is6BOSBQYyrIV58H-QWFKLsiVP1sJ2Vou-IKJgTQ18BFDW8jSM5cgzQdri%2F1769702400000%2F0%2F1769675500553%2F0%22; bd_ticket_guard_client_data_v2=eyJyZWVfcHVibGljX2tleSI6IkJJTFdIQ3JPUkJ6SFNjM0ErNXJnUXRPOUFPcEFjek15bW8vcVFSd0xLTmhxcmxUQ0gzalc5VjFkaHJvcnQvZytrNWNXdU4zVlhsYTBRUmpnVkFXL3Vrcz0iLCJ0c19zaWduIjoidHMuMi41MTNlZDBjNTk1N2RjYjUzZTEwZmVhOWYwZTEzZjQ3MGJiNjE2ODNiZGUyZmY1MDA5YjNhYzY1ZGE4YWI0NjhhYzRmYmU4N2QyMzE5Y2YwNTMxODYyNGNlZGExNDkxMWNhNDA2ZGVkYmViZWRkYjJlMzBmY2U4ZDRmYTAyNTc1ZCIsInJlcV9jb250ZW50Ijoic2VjX3RzIiwicmVxX3NpZ24iOiJnQklNQXhmSlRoZnpnTHhpSXBSaTRBbnVWTXRNT2VrK0NVM1FRL0lpbzB3PSIsInNlY190cyI6IiNHOHBUQ0VnQU1ibm0rb3FRdjBhRjUzek5zcHNHZkp6dkdZempUSHowVFN0K1phWUVSdnkybXFqS2NvbjAifQ%3D%3D; device_web_cpu_core=10; device_web_memory_size=8; =douyin.com; IsDouyinActive=true; stream_recommend_feed_params=%22%7B%5C%22cookie_enabled%5C%22%3Atrue%2C%5C%22screen_width%5C%22%3A1920%2C%5C%22screen_height%5C%22%3A1080%2C%5C%22browser_online%5C%22%3Atrue%2C%5C%22cpu_core_num%5C%22%3A10%2C%5C%22device_memory%5C%22%3A8%2C%5C%22downlink%5C%22%3A1.65%2C%5C%22effective_type%5C%22%3A%5C%224g%5C%22%2C%5C%22round_trip_time%5C%22%3A200%7D%22; FOLLOW_LIVE_POINT_INFO=%22MS4wLjABAAAAVyy1S3Is6BOSBQYyrIV58H-QWFKLsiVP1sJ2Vou-IKJgTQ18BFDW8jSM5cgzQdri%2F1769702400000%2F0%2F1769679350375%2F0%22; home_can_add_dy_2_desktop=%221%22; bd_ticket_guard_client_data=eyJiZC10aWNrZXQtZ3VhcmQtdmVyc2lvbiI6MiwiYmQtdGlja2V0LWd1YXJkLWl0ZXJhdGlvbi12ZXJzaW9uIjoxLCJiZC10aWNrZXQtZ3VhcmQtcmVlLXB1YmxpYy1rZXkiOiJCSUxXSENyT1JCekhTYzNBKzVyZ1F0TzlBT3BBY3pNeW1vL3FRUndMS05ocXJsVENIM2pXOVYxZGhyb3J0L2crazVjV3VOM1ZYbGEwUVJqZ1ZBVy91a3M9IiwiYmQtdGlja2V0LWd1YXJkLXdlYi12ZXJzaW9uIjoyfQ%3D%3D; odin_tt=1306800cba9b2ade82e6b328517cb7b9bd46d57a95cb3d378279b4dcb4875309c878e405ccd97ff6ae451f9aee07210330b7cca0fc2eaa19885e3444c4cad1c3; biz_trace_id=23bb8913; sdk_source_info=7e276470716a68645a606960273f2771777060272927676c715a6d6069756077273f276364697660272927666d776a68605a607d71606b766c6a6b5a7666776c7571273f275e58272927666a6b766a69605a696c6061273f27636469766027292762696a6764695a7364776c6467696076273f275e582729277672715a646971273f2763646976602729277f6b5a666475273f2763646976602729276d6a6e5a6b6a716c273f2763646976602729276c6b6f5a7f6367273f27636469766027292771273f273337333330363c32333c333234272927676c715a75776a716a666a69273f2763646976602778; bit_env=C1Q0wwsAlnTFEcYmA4ecYxrlA1Ko9T1ZRsBxt8w5JeSjLZwGc8_iN8HhxVj_cvHQAfg_-CjcqbQegl4Ueprl4TOz0TQWS4POYHc95BjRZeVvTh_A1Uv-SpgjHiU0_xD1H9zSpaRSG-IDV1z7AQrJTAHSwvU0a3PJuoPvwIjctbYpk_zSzGzF3jcAD2AGTTEqjMnMyees4BI3Xdm0gJtijw6q6dsgGEM0gPftblvyTCjKDnI6nQWPAat4PuE55Uj-QVtKjN5Gn9gTwDo1jQmrEBzkH-vdsnjSykplWZe8j-v4SZxTYww2M0zJ4uQ_H2bKGzA7E7X83jQilLvJxkAxuCLNdwmVEf-zvNwP5o7jNEZ-Bjfm_vvpuxbwct5qkwsJp-lumTX0on4VMvBXj5tfb9_9FyjogsGNEDOS8SBr50oTDLWxfnWW8pUzAUdKOtL2iLca9SwEqrlnzj7U4tz9L0bUp_9U2EgK1YkvdwpXscuh1neQiPLRHx4qQ5ZIpkFzmUxfUojCY1NsJqxS20_NMLRS5u4u2ZUHRUee68kJ-gw%3D; gulu_source_res=eyJwX2luIjoiMmMwYzJkZGRkYTgwMzhlNjQwZDA1MTNlODFmZjUxYzA4MDBlMjQ0Y2Q4M2QzNTIyMzAzN2Y1MjVmZDAyY2VjYSJ9; passport_auth_mix_state=36iko0gveklaj9927wyn2cjxq2siaqzg"""

async def update_cookies():
    print("üìù [Update] Updating Douyin cookies in DB...")
    async with get_session() as session:
        # 1. Update active dy account with RAW SQL
        stmt = text("SELECT id, account_name FROM growhub_accounts WHERE platform = 'dy' LIMIT 1")
        result = await session.execute(stmt)
        account = result.first()
        
        if not account:
            print("‚ùå [Update] No Douyin account found.")
            return
            
        print(f"‚úÖ [Update] Updating account: {account.account_name}")
        
        # Using RAW SQL update
        stmt = text("""
            UPDATE growhub_accounts 
            SET cookies = :cookies, status = 'active', updated_at = CURRENT_TIMESTAMP
            WHERE id = :id
        """)
        await session.execute(stmt, {"cookies": NEW_COOKIES, "id": account.id})
        await session.commit()
        print("üíæ [Update] Database Updated Successfully with Raw SQL!")

if __name__ == "__main__":
    asyncio.run(update_cookies())
